# ğŸš€ {{ project_name }} - Justfile
# Compatible Windows, Linux, macOS

set windows-shell := ["powershell.exe", "-NoLogo", "-Command"]

# Variables
PYTHON_VERSION := "{{ python_version }}"
PROJECT_NAME := "{{ project_slug }}"

# ğŸ¯ Setup complet du projet
setup:
    uv init --python {{ python_version }}
    uv venv --python {{ python_version }}
    uv sync

# ğŸš€ Lancement de l'application
run:
    uv run streamlit run main.py

# ğŸ“¦ Synchronisation des dÃ©pendances
sync:
    uv sync

# ğŸ“¦ Ajout d'une dÃ©pendance
add PACKAGE:
    uv add {% raw %}{{ PACKAGE }}{% endraw %}

# ğŸ“¦ Ajout d'une dÃ©pendance de dev
add-dev PACKAGE:
    uv add --dev {% raw %}{{ PACKAGE }}{% endraw %}

# ğŸ“„ GÃ©nÃ©ration du requirements.txt
requirements:
    uv pip compile pyproject.toml -o requirements.txt

# ğŸ CrÃ©ation de l'environnement virtuel
venv:
    uv venv --python {{ python_version }}

# ğŸ§¹ Nettoyage (compatible toutes plateformes via Python)
clean:
    python -c "import shutil, pathlib; [shutil.rmtree(p, ignore_errors=True) for p in [pathlib.Path('.venv')] if p.exists()]; [p.unlink() for p in pathlib.Path('.').rglob('*.pyc')]; [shutil.rmtree(p, ignore_errors=True) for p in pathlib.Path('.').rglob('__pycache__')]"

# ğŸ”„ RÃ©installation complÃ¨te
reset: clean setup

# ğŸ“Š Mode dÃ©veloppement
dev:
    uv run streamlit run main.py --server.runOnSave=true --server.developmentMode=true

# ğŸ§ª Tests
test:
    uv run pytest tests/ -v

# â„¹ï¸ Informations
info:
    @echo "ğŸ“‹ {{ project_name }}"
    @echo "  ğŸ Python: {{ python_version }}"
    @echo "  ğŸ‘¤ Auteur: {{ author_name }}"

# ğŸ“š Aide
help:
    @echo "ğŸš€ {{ project_name }} - Commandes disponibles"
    @echo ""
    @echo "Principales:"
    @echo "  just setup  - Setup complet"
    @echo "  just run    - Lancer l'application"
    @echo "  just dev    - Mode dÃ©veloppement"
    @echo ""
    @echo "DÃ©pendances:"
    @echo "  just sync              - Synchroniser"
    @echo "  just add PACKAGE       - Ajouter une lib"
    @echo "  just add-dev PACKAGE   - Ajouter une lib de dev"
    @echo "  just requirements      - GÃ©nÃ©rer requirements.txt"
    @echo ""
    @echo "Maintenance:"
    @echo "  just clean - Nettoyer"
    @echo "  just reset - RÃ©installer"
    @echo "  just test  - Tests"

# Commande par dÃ©faut
default: help