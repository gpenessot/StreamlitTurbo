# ğŸš€ {{ project_name }} - Justfile Cross-Platform
# Compatible Windows (PowerShell), Linux et macOS

# Configuration automatique du shell selon l'OS
set windows-shell := ["powershell.exe", "-NoLogo", "-Command"]

# Variables
PYTHON_VERSION := "{{ python_version }}"
PROJECT_NAME := "{{ project_slug }}"

# ğŸ¯ Setup complet du projet en une commande
setup:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸš€ Setup complet de {{ project_name }}..." -ForegroundColor Green
        @Write-Host "ğŸ“¦ Initialisation du projet avec uv..." -ForegroundColor Cyan
    {{{{ else }}}}
        @echo "ğŸš€ Setup complet de {{ project_name }}..."
        @echo "ğŸ“¦ Initialisation du projet avec uv..."
    {{{{ endif }}}}
    uv init --python {{ python_version }}
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ CrÃ©ation de l'environnement virtuel..." -ForegroundColor Cyan
    {{{{ else }}}}
        @echo "ğŸ CrÃ©ation de l'environnement virtuel..."
    {{{{ endif }}}}
    uv venv --python {{ python_version }}
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ“š Installation des dÃ©pendances..." -ForegroundColor Cyan
    {{{{ else }}}}
        @echo "ğŸ“š Installation des dÃ©pendances..."
    {{{{ endif }}}}
    uv sync
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "âœ… Setup terminÃ© ! Lancez 'just run' pour dÃ©marrer l'app." -ForegroundColor Green
    {{{{ else }}}}
        @echo "âœ… Setup terminÃ© ! Lancez 'just run' pour dÃ©marrer l'app."
    {{{{ endif }}}}

# ğŸš€ Lancement de l'application Streamlit
run:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸš€ Lancement de {{ project_name }}..." -ForegroundColor Green
    {{{{ else }}}}
        @echo "ğŸš€ Lancement de {{ project_name }}..."
    {{{{ endif }}}}
    uv run streamlit run main.py

# ğŸ“¦ Synchronisation des dÃ©pendances
sync:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ“¦ Synchronisation des dÃ©pendances..." -ForegroundColor Cyan
    {{{{ else }}}}
        @echo "ğŸ“¦ Synchronisation des dÃ©pendances..."
    {{{{ endif }}}}
    uv sync

# ğŸ“¦ Ajout d'une nouvelle dÃ©pendance
add PACKAGE:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ“¦ Ajout de {{{{ PACKAGE }}}}..." -ForegroundColor Cyan
    {{{{ else }}}}
        @echo "ğŸ“¦ Ajout de {{{{ PACKAGE }}}}..."
    {{{{ endif }}}}
    uv add {{{{ PACKAGE }}}}
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "âœ… {{{{ PACKAGE }}}} ajoutÃ©." -ForegroundColor Green
    {{{{ else }}}}
        @echo "âœ… {{{{ PACKAGE }}}} ajoutÃ©."
    {{{{ endif }}}}

# ğŸ“¦ Ajout d'une dÃ©pendance de dÃ©veloppement
add-dev PACKAGE:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ”§ Ajout de {{{{ PACKAGE }}}} (dev)..." -ForegroundColor Cyan
    {{{{ else }}}}
        @echo "ğŸ”§ Ajout de {{{{ PACKAGE }}}} (dev)..."
    {{{{ endif }}}}
    uv add --dev {{{{ PACKAGE }}}}
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "âœ… {{{{ PACKAGE }}}} ajoutÃ©." -ForegroundColor Green
    {{{{ else }}}}
        @echo "âœ… {{{{ PACKAGE }}}} ajoutÃ©."
    {{{{ endif }}}}

# ğŸ“„ GÃ©nÃ©ration du requirements.txt pour dÃ©ploiement
requirements:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ“„ GÃ©nÃ©ration du requirements.txt..." -ForegroundColor Cyan
    {{{{ else }}}}
        @echo "ğŸ“„ GÃ©nÃ©ration du requirements.txt..."
    {{{{ endif }}}}
    uv pip compile pyproject.toml -o requirements.txt
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "âœ… requirements.txt gÃ©nÃ©rÃ©." -ForegroundColor Green
    {{{{ else }}}}
        @echo "âœ… requirements.txt gÃ©nÃ©rÃ©."
    {{{{ endif }}}}

# ğŸ CrÃ©ation de l'environnement virtuel
venv:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ CrÃ©ation de l'environnement virtuel..." -ForegroundColor Cyan
    {{{{ else }}}}
        @echo "ğŸ CrÃ©ation de l'environnement virtuel..."
    {{{{ endif }}}}
    uv venv --python {{ python_version }}

# ğŸ§¹ Nettoyage de l'environnement (cross-platform avec Python)
clean:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ§¹ Nettoyage de l'environnement..." -ForegroundColor Yellow
    {{{{ else }}}}
        @echo "ğŸ§¹ Nettoyage de l'environnement..."
    {{{{ endif }}}}
    python -c "import shutil, pathlib; [shutil.rmtree(p, ignore_errors=True) for p in ['.venv', *pathlib.Path('.').rglob('__pycache__'), *pathlib.Path('.').rglob('*.pyc'), *pathlib.Path('.').rglob('*.pyo')]]"
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "âœ… Nettoyage terminÃ©." -ForegroundColor Green
    {{{{ else }}}}
        @echo "âœ… Nettoyage terminÃ©."
    {{{{ endif }}}}

# ğŸ”„ RÃ©installation complÃ¨te
reset: clean setup

# ğŸ“Š Lancement en mode dÃ©veloppement
dev:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ”§ Lancement en mode dÃ©veloppement..." -ForegroundColor Cyan
    {{{{ else }}}}
        @echo "ğŸ”§ Lancement en mode dÃ©veloppement..."
    {{{{ endif }}}}
    uv run streamlit run main.py --server.runOnSave=true --server.developmentMode=true

# ğŸ§ª Tests
test:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ§ª Lancement des tests..." -ForegroundColor Cyan
    {{{{ else }}}}
        @echo "ğŸ§ª Lancement des tests..."
    {{{{ endif }}}}
    uv run pytest tests/ -v

# â„¹ï¸ Informations sur le projet
info:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸ“‹ Informations sur {{ project_name }}:" -ForegroundColor Cyan
        @Write-Host "  ğŸ“ Projet: {{ project_name }}"
        @Write-Host "  ğŸ”§ Slug: {{ project_slug }}"
        @Write-Host "  ğŸ Python: {{ python_version }}"
        @Write-Host "  ğŸ‘¤ Auteur: {{ author_name }}"
        @Write-Host "  ğŸ“§ Email: {{ author_email }}"
        @Write-Host "  ğŸ’» OS: Windows"
    {{{{ else }}}}
        @echo "ğŸ“‹ Informations sur {{ project_name }}:"
        @echo "  ğŸ“ Projet: {{ project_name }}"
        @echo "  ğŸ”§ Slug: {{ project_slug }}"
        @echo "  ğŸ Python: {{ python_version }}"
        @echo "  ğŸ‘¤ Auteur: {{ author_name }}"
        @echo "  ğŸ“§ Email: {{ author_email }}"
        @echo "  ğŸ’» OS: {{{{ os_family() }}}}"
    {{{{ endif }}}}

# ğŸ“š Aide - Liste toutes les commandes
help:
    {{{{ if os_family() == "windows" }}}}
        @Write-Host "ğŸš€ {{ project_name }} - Commandes disponibles:" -ForegroundColor Green
        @Write-Host ""
        @Write-Host "ğŸ¯ Commandes principales:" -ForegroundColor Yellow
        @Write-Host "  just setup     - Setup complet du projet"
        @Write-Host "  just run       - Lancer l'application"
        @Write-Host "  just dev       - Mode dÃ©veloppement"
        @Write-Host ""
        @Write-Host "ğŸ“¦ Gestion des dÃ©pendances:" -ForegroundColor Yellow
        @Write-Host "  just sync              - Synchroniser"
        @Write-Host "  just add PACKAGE       - Ajouter une lib"
        @Write-Host "  just add-dev PACKAGE   - Ajouter une lib de dev"
        @Write-Host "  just requirements      - GÃ©nÃ©rer requirements.txt"
        @Write-Host ""
        @Write-Host "ğŸ”§ Maintenance:" -ForegroundColor Yellow
        @Write-Host "  just clean     - Nettoyer"
        @Write-Host "  just reset     - RÃ©installer"
        @Write-Host "  just test      - Tests"
        @Write-Host ""
        @Write-Host "â„¹ï¸ Informations:" -ForegroundColor Yellow
        @Write-Host "  just info      - Infos projet"
        @Write-Host "  just help      - Cette aide"
    {{{{ else }}}}
        @echo "ğŸš€ {{ project_name }} - Commandes disponibles:"
        @echo ""
        @echo "ğŸ¯ Commandes principales:"
        @echo "  just setup     - Setup complet du projet"
        @echo "  just run       - Lancer l'application"
        @echo "  just dev       - Mode dÃ©veloppement"
        @echo ""
        @echo "ğŸ“¦ Gestion des dÃ©pendances:"
        @echo "  just sync              - Synchroniser"
        @echo "  just add PACKAGE       - Ajouter une lib"
        @echo "  just add-dev PACKAGE   - Ajouter une lib de dev"
        @echo "  just requirements      - GÃ©nÃ©rer requirements.txt"
        @echo ""
        @echo "ğŸ”§ Maintenance:"
        @echo "  just clean     - Nettoyer"
        @echo "  just reset     - RÃ©installer"
        @echo "  just test      - Tests"
        @echo ""
        @echo "â„¹ï¸ Informations:"
        @echo "  just info      - Infos projet"
        @echo "  just help      - Cette aide"
    {{{{ endif }}}}

# Commande par dÃ©faut
default: help
# Configuration pour Windows - DOIT Ãªtre en premiÃ¨re ligne
set windows-shell := ["powershell.exe", "-NoLogo", "-Command"]

# ğŸš€ {{ project_name }} - Justfile
# Automatisation complÃ¨te avec uv pour un dÃ©veloppement express

# Variables
PYTHON_VERSION := "{{ python_version }}"
PROJECT_NAME := "{{ project_slug }}"

# ğŸ¯ Setup complet du projet en une commande
setup:
    @Write-Host "ğŸš€ Setup complet de {{ project_name }}..." -ForegroundColor Green
    @Write-Host "ğŸ“¦ Initialisation du projet avec uv..." -ForegroundColor Cyan
    uv init --python {{ python_version }}
    @Write-Host "ğŸ CrÃ©ation de l'environnement virtuel..." -ForegroundColor Cyan
    uv venv --python {{ python_version }}
    @Write-Host "ğŸ“š Installation des dÃ©pendances depuis pyproject.toml..." -ForegroundColor Cyan
    uv sync
    @Write-Host "âœ… Setup terminÃ© ! Lancez 'just run' pour dÃ©marrer l'app." -ForegroundColor Green

# ğŸš€ Lancement de l'application Streamlit
run:
    @Write-Host "ğŸš€ Lancement de {{ project_name }}..." -ForegroundColor Green
    uv run streamlit run main.py

# ğŸ“¦ Installation/mise Ã  jour des dÃ©pendances depuis pyproject.toml
sync:
    @Write-Host "ğŸ“¦ Synchronisation des dÃ©pendances..." -ForegroundColor Cyan
    uv sync

# ğŸ“¦ Ajout d'une nouvelle dÃ©pendance
add PACKAGE:
    @Write-Host "ğŸ“¦ Ajout de {{{{ PACKAGE }}}}..." -ForegroundColor Cyan
    uv add {{{{ PACKAGE }}}}
    @Write-Host "âœ… {{{{ PACKAGE }}}} ajoutÃ© au pyproject.toml." -ForegroundColor Green

# ğŸ“¦ Ajout d'une dÃ©pendance de dÃ©veloppement
add-dev PACKAGE:
    @Write-Host "ğŸ”§ Ajout de {{{{ PACKAGE }}}} (dev)..." -ForegroundColor Cyan
    uv add --dev {{{{ PACKAGE }}}}
    @Write-Host "âœ… {{{{ PACKAGE }}}} ajoutÃ© aux dÃ©pendances de dÃ©veloppement." -ForegroundColor Green

# ğŸ“„ GÃ©nÃ©ration du requirements.txt pour dÃ©ploiement (Streamlit Cloud)
requirements:
    @Write-Host "ğŸ“„ GÃ©nÃ©ration du requirements.txt depuis pyproject.toml..." -ForegroundColor Cyan
    uv pip compile pyproject.toml -o requirements.txt
    @Write-Host "âœ… requirements.txt gÃ©nÃ©rÃ© pour le dÃ©ploiement." -ForegroundColor Green

# ğŸ CrÃ©ation de l'environnement virtuel uniquement
venv:
    @Write-Host "ğŸ CrÃ©ation de l'environnement virtuel..." -ForegroundColor Cyan
    uv venv --python {{ python_version }}

# ğŸ§¹ Nettoyage de l'environnement (compatible Windows)
clean:
    @Write-Host "ğŸ§¹ Nettoyage de l'environnement..." -ForegroundColor Yellow
    @if (Test-Path .venv) { Remove-Item -Recurse -Force .venv }
    @Get-ChildItem -Recurse -Filter "__pycache__" | Remove-Item -Recurse -Force
    @Get-ChildItem -Recurse -Filter "*.pyc" | Remove-Item -Force
    @Get-ChildItem -Recurse -Filter "*.pyo" | Remove-Item -Force
    @Write-Host "âœ… Nettoyage terminÃ©." -ForegroundColor Green

# ğŸ”„ RÃ©installation complÃ¨te
reset: clean setup

# ğŸ“Š Lancement avec mode debug
dev:
    @Write-Host "ğŸ”§ Lancement en mode dÃ©veloppement..." -ForegroundColor Cyan
    uv run streamlit run main.py --server.runOnSave=true --server.developmentMode=true

# ğŸ§ª Tests (si prÃ©sents)
test:
    @Write-Host "ğŸ§ª Lancement des tests..." -ForegroundColor Cyan
    uv run pytest tests/ -v

# â„¹ï¸ Informations sur le projet
info:
    @Write-Host "ğŸ“‹ Informations sur {{ project_name }}:" -ForegroundColor Cyan
    @Write-Host "  ğŸ“ Projet: {{ project_name }}"
    @Write-Host "  ğŸ”§ Slug: {{ project_slug }}"
    @Write-Host "  ğŸ Python: {{ python_version }}"
    @Write-Host "  ğŸ‘¤ Auteur: {{ author_name }}"
    @Write-Host "  ğŸ“§ Email: {{ author_email }}"

# ğŸ“š Aide - Liste toutes les commandes disponibles
help:
    @Write-Host "ğŸš€ {{ project_name }} - Commandes disponibles:" -ForegroundColor Green
    @Write-Host ""
    @Write-Host "ğŸ¯ Commandes principales:" -ForegroundColor Yellow
    @Write-Host "  just setup     - Setup complet du projet (init + venv + sync)"
    @Write-Host "  just run       - Lancer l'application Streamlit"
    @Write-Host "  just dev       - Lancer en mode dÃ©veloppement"
    @Write-Host ""
    @Write-Host "ğŸ“¦ Gestion des dÃ©pendances avec uv:" -ForegroundColor Yellow
    @Write-Host "  just sync              - Synchroniser les dÃ©pendances depuis pyproject.toml"
    @Write-Host "  just add PACKAGE       - Ajouter une dÃ©pendance"
    @Write-Host "  just add-dev PACKAGE   - Ajouter une dÃ©pendance de dev"
    @Write-Host "  just requirements      - GÃ©nÃ©rer requirements.txt pour dÃ©ploiement"
    @Write-Host ""
    @Write-Host "ğŸ”§ Maintenance:" -ForegroundColor Yellow
    @Write-Host "  just venv      - CrÃ©er l'environnement virtuel"
    @Write-Host "  just clean     - Nettoyer l'environnement"
    @Write-Host "  just reset     - RÃ©installation complÃ¨te"
    @Write-Host "  just test      - Lancer les tests"
    @Write-Host ""
    @Write-Host "â„¹ï¸ Informations:" -ForegroundColor Yellow
    @Write-Host "  just info      - Infos sur le projet"
    @Write-Host "  just help      - Afficher cette aide"
    @Write-Host ""
    @Write-Host "ğŸ’¡ Usage rapide:" -ForegroundColor Cyan
    @Write-Host "  1ï¸âƒ£ just setup        # Premier lancement"
    @Write-Host "  2ï¸âƒ£ just run          # Lancer l'app"
    @Write-Host "  3ï¸âƒ£ just add pandas   # Ajouter une lib"
    @Write-Host "  4ï¸âƒ£ just requirements # Avant dÃ©ploiement"

# Commande par dÃ©faut (affiche l'aide)
default: help