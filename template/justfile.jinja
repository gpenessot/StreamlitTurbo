# ğŸš€ {{ project_name }} - Justfile
# Automatisation complÃ¨te avec uv pour un dÃ©veloppement express

# Variables
PYTHON_VERSION := "{{ python_version }}"
PROJECT_NAME := "{{ project_slug }}"

# ğŸ¯ Setup complet du projet en une commande
setup:
    @echo "ğŸš€ Setup complet de {{ project_name }}..."
    @echo "ğŸ“¦ Initialisation du projet avec uv..."
    uv init --python {{ python_version }}
    @echo "ğŸ CrÃ©ation de l'environnement virtuel..."
    uv venv --python {{ python_version }}
    @echo "ğŸ“š Installation des dÃ©pendances depuis pyproject.toml..."
    uv sync
    @echo "âœ… Setup terminÃ© ! Lancez 'just run' pour dÃ©marrer l'app."

# ğŸš€ Lancement de l'application Streamlit
run:
    @echo "ğŸš€ Lancement de {{ project_name }}..."
    uv run streamlit run main.py

# ğŸ“¦ Installation/mise Ã  jour des dÃ©pendances depuis pyproject.toml
sync:
    @echo "ğŸ“¦ Synchronisation des dÃ©pendances..."
    uv sync

# ğŸ“¦ Ajout d'une nouvelle dÃ©pendance
add PACKAGE:
    @echo "ğŸ“¦ Ajout de {{ PACKAGE }}..."
    uv add {{ PACKAGE }}
    @echo "âœ… {{ PACKAGE }} ajoutÃ© au pyproject.toml."

# ğŸ“¦ Ajout d'une dÃ©pendance de dÃ©veloppement
add-dev PACKAGE:
    @echo "ğŸ”§ Ajout de {{ PACKAGE }} (dev)..."
    uv add --dev {{ PACKAGE }}
    @echo "âœ… {{ PACKAGE }} ajoutÃ© aux dÃ©pendances de dÃ©veloppement."

# ğŸ“„ GÃ©nÃ©ration du requirements.txt pour dÃ©ploiement (Streamlit Cloud)
requirements:
    @echo "ğŸ“„ GÃ©nÃ©ration du requirements.txt depuis pyproject.toml..."
    uv pip compile pyproject.toml -o requirements.txt
    @echo "âœ… requirements.txt gÃ©nÃ©rÃ© pour le dÃ©ploiement."

# ğŸ CrÃ©ation de l'environnement virtuel uniquement
venv:
    @echo "ğŸ CrÃ©ation de l'environnement virtuel..."
    uv venv --python {{ python_version }}

# ğŸ§¹ Nettoyage de l'environnement
clean:
    @echo "ğŸ§¹ Nettoyage de l'environnement..."
    rm -rf .venv/
    rm -rf __pycache__/
    find . -name "*.pyc" -delete
    find . -name "*.pyo" -delete
    @echo "âœ… Nettoyage terminÃ©."

# ğŸ”„ RÃ©installation complÃ¨te
reset: clean setup

# ğŸ“Š Lancement avec mode debug
dev:
    @echo "ğŸ”§ Lancement en mode dÃ©veloppement..."
    uv run streamlit run main.py --server.runOnSave=true --server.developmentMode=true

# ğŸ§ª Tests (si prÃ©sents)
test:
    @echo "ğŸ§ª Lancement des tests..."
    uv run pytest tests/ -v

# â„¹ï¸ Informations sur le projet
info:
    @echo "ğŸ“‹ Informations sur {{ project_name }}:"
    @echo "  ğŸ“ Projet: {{ project_name }}"
    @echo "  ğŸ”§ Slug: {{ project_slug }}"
    @echo "  ğŸ Python: {{ python_version }}"
    @echo "  ğŸ‘¤ Auteur: {{ author_name }}"
    @echo "  ğŸ“§ Email: {{ author_email }}"

# ğŸ“š Aide - Liste toutes les commandes disponibles
help:
    @echo "ğŸš€ {{ project_name }} - Commandes disponibles:"
    @echo ""
    @echo "ğŸ¯ Commandes principales:"
    @echo "  just setup     - Setup complet du projet (init + venv + sync)"
    @echo "  just run       - Lancer l'application Streamlit"
    @echo "  just dev       - Lancer en mode dÃ©veloppement"
    @echo ""
    @echo "ğŸ“¦ Gestion des dÃ©pendances avec uv:"
    @echo "  just sync              - Synchroniser les dÃ©pendances depuis pyproject.toml"
    @echo "  just add PACKAGE       - Ajouter une dÃ©pendance"
    @echo "  just add-dev PACKAGE   - Ajouter une dÃ©pendance de dev"
    @echo "  just requirements      - GÃ©nÃ©rer requirements.txt pour dÃ©ploiement"
    @echo ""
    @echo "ğŸ”§ Maintenance:"
    @echo "  just venv      - CrÃ©er l'environnement virtuel"
    @echo "  just clean     - Nettoyer l'environnement"
    @echo "  just reset     - RÃ©installation complÃ¨te"
    @echo "  just test      - Lancer les tests"
    @echo ""
    @echo "â„¹ï¸ Informations:"
    @echo "  just info      - Infos sur le projet"
    @echo "  just help      - Afficher cette aide"
    @echo ""
    @echo "ğŸ’¡ Usage rapide:"
    @echo "  1ï¸âƒ£ just setup        # Premier lancement"
    @echo "  2ï¸âƒ£ just run          # Lancer l'app"
    @echo "  3ï¸âƒ£ just add pandas   # Ajouter une lib"
    @echo "  4ï¸âƒ£ just requirements # Avant dÃ©ploiement"

# Commande par dÃ©faut (affiche l'aide)
default: help
