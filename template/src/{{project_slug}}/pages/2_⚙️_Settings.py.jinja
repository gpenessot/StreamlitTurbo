"""
Page Settings - Configuration et paramÃ¨tres de l'application
"""

import streamlit as st
from datetime import datetime

# Configuration de la page
st.set_page_config(
    page_title="Settings - {{ project_name }}",
    page_icon="âš™ï¸",
    layout="wide"
)

def main():
    """Page principale des paramÃ¨tres."""
    st.title("âš™ï¸ ParamÃ¨tres")
    st.markdown("Configurez votre application selon vos besoins")
    
    # Initialiser les valeurs par dÃ©faut dans session_state
    if 'user_name' not in st.session_state:
        st.session_state.user_name = "{{ author_name }}"
    if 'notifications_enabled' not in st.session_state:
        st.session_state.notifications_enabled = True
    if 'theme_preference' not in st.session_state:
        st.session_state.theme_preference = "{{ streamlit_theme }}"
    if 'data_refresh_interval' not in st.session_state:
        st.session_state.data_refresh_interval = 60
    
    # Onglets pour organiser les paramÃ¨tres
    tab1, tab2, tab3, tab4 = st.tabs(["ğŸ‘¤ Profil", "ğŸ¨ Apparence", "ğŸ“Š DonnÃ©es", "ğŸ”” Notifications"])
    
    with tab1:
        st.subheader("ğŸ‘¤ Informations du profil")
        
        col1, col2 = st.columns(2)
        
        with col1:
            user_name = st.text_input(
                "Nom d'utilisateur",
                value=st.session_state.user_name,
                help="Votre nom d'affichage dans l'application"
            )
            
            user_email = st.text_input(
                "Email",
                value="{{ author_email }}",
                help="Votre adresse email pour les notifications"
            )
            
            user_role = st.selectbox(
                "RÃ´le",
                ["Admin", "Utilisateur", "Visiteur"],
                index=0,
                help="Votre niveau d'accÃ¨s dans l'application"
            )
        
        with col2:
            st.markdown("#### ğŸ“Š Statistiques d'utilisation")
            st.metric("Connexions totales", "247")
            st.metric("DerniÃ¨re connexion", "Il y a 2 minutes")
            st.metric("Temps passÃ©", "12h 34m")
            
        if st.button("ğŸ’¾ Sauvegarder le profil", type="primary"):
            st.session_state.user_name = user_name
            st.success("âœ… Profil sauvegardÃ© avec succÃ¨s !")
    
    with tab2:
        st.subheader("ğŸ¨ Personnalisation de l'apparence")
        
        col1, col2 = st.columns(2)
        
        with col1:
            theme = st.selectbox(
                "ThÃ¨me de l'interface",
                ["light", "dark", "auto"],
                index=["light", "dark", "auto"].index(st.session_state.theme_preference),
                help="Choisissez votre thÃ¨me prÃ©fÃ©rÃ©"
            )
            
            layout_width = st.selectbox(
                "Largeur de la mise en page",
                ["centered", "wide"],
                index=0,
                help="Largeur par dÃ©faut des pages"
            )
            
            sidebar_state = st.selectbox(
                "Ã‰tat initial de la sidebar",
                ["expanded", "collapsed", "auto"],
                index=0
            )
        
        with col2:
            st.markdown("#### ğŸ¨ AperÃ§u du thÃ¨me")
            
            # Simuler un aperÃ§u avec des couleurs
            if theme == "light":
                st.success("ğŸŒ ThÃ¨me clair sÃ©lectionnÃ©")
                st.markdown("""
                <div style='padding: 1rem; background: #f0f2f6; border-radius: 0.5rem; color: #262730;'>
                    Exemple de contenu avec le thÃ¨me clair
                </div>
                """, unsafe_allow_html=True)
            elif theme == "dark":
                st.info("ğŸŒ™ ThÃ¨me sombre sÃ©lectionnÃ©")
                st.markdown("""
                <div style='padding: 1rem; background: #0e1117; border-radius: 0.5rem; color: #fafafa;'>
                    Exemple de contenu avec le thÃ¨me sombre
                </div>
                """, unsafe_allow_html=True)
            else:
                st.warning("ğŸ”„ ThÃ¨me automatique sÃ©lectionnÃ©")
        
        if st.button("ğŸ¨ Appliquer le thÃ¨me", type="primary"):
            st.session_state.theme_preference = theme
            st.success(f"âœ… ThÃ¨me '{theme}' appliquÃ© ! Rechargez la page pour voir les changements.")
    
    with tab3:
        st.subheader("ğŸ“Š Configuration des donnÃ©es")
        
        col1, col2 = st.columns(2)
        
        with col1:
            refresh_interval = st.slider(
                "Intervalle de rafraÃ®chissement (secondes)",
                min_value=10,
                max_value=300,
                value=st.session_state.data_refresh_interval,
                step=10,
                help="FrÃ©quence de mise Ã  jour automatique des donnÃ©es"
            )
            
            cache_duration = st.selectbox(
                "DurÃ©e du cache",
                ["1 minute", "5 minutes", "15 minutes", "1 heure"],
                index=1,
                help="DurÃ©e de conservation des donnÃ©es en cache"
            )
            
            max_records = st.number_input(
                "Nombre maximum d'enregistrements",
                min_value=100,
                max_value=10000,
                value=1000,
                step=100,
                help="Limite d'enregistrements Ã  afficher dans les tableaux"
            )
        
        with col2:
            st.markdown("#### ğŸ“ˆ Options d'export")
            
            export_format = st.multiselect(
                "Formats d'export disponibles",
                ["CSV", "Excel", "JSON", "PDF"],
                default=["CSV", "Excel"],
                help="Formats de fichiers pour l'export des donnÃ©es"
            )
            
            auto_backup = st.checkbox(
                "Sauvegarde automatique",
                value=True,
                help="Sauvegarder automatiquement les paramÃ¨tres"
            )
            
            compress_exports = st.checkbox(
                "Compresser les exports",
                value=False,
                help="Compresser les fichiers exportÃ©s (ZIP)"
            )
        
        if st.button("ğŸ“Š Sauvegarder la configuration", type="primary"):
            st.session_state.data_refresh_interval = refresh_interval
            st.success("âœ… Configuration des donnÃ©es sauvegardÃ©e !")
    
    with tab4:
        st.subheader("ğŸ”” ParamÃ¨tres de notification")
        
        col1, col2 = st.columns(2)
        
        with col1:
            notifications_enabled = st.checkbox(
                "Activer les notifications",
                value=st.session_state.notifications_enabled,
                help="Recevoir des notifications de l'application"
            )
            
            if notifications_enabled:
                email_notifications = st.checkbox(
                    "Notifications par email",
                    value=True,
                    help="Recevoir des notifications par email"
                )
                
                browser_notifications = st.checkbox(
                    "Notifications du navigateur",
                    value=False,
                    help="Afficher des notifications dans le navigateur"
                )
                
                notification_frequency = st.selectbox(
                    "FrÃ©quence des notifications",
                    ["ImmÃ©diate", "Quotidienne", "Hebdomadaire"],
                    index=0
                )
        
        with col2:
            st.markdown("#### ğŸ“§ Types de notifications")
            
            if notifications_enabled:
                notify_data_updates = st.checkbox("Mises Ã  jour de donnÃ©es", True)
                notify_errors = st.checkbox("Erreurs systÃ¨me", True)
                notify_reports = st.checkbox("Rapports automatiques", False)
                notify_maintenance = st.checkbox("Maintenance programmÃ©e", True)
            else:
                st.info("Activez les notifications pour configurer les types")
        
        if st.button("ğŸ”” Sauvegarder les notifications", type="primary"):
            st.session_state.notifications_enabled = notifications_enabled
            st.success("âœ… ParamÃ¨tres de notification sauvegardÃ©s !")
    
    # Section de debug/informations systÃ¨me
    with st.expander("ğŸ”§ Informations systÃ¨me"):
        col1, col2 = st.columns(2)
        
        with col1:
            st.markdown("#### ğŸ“‹ Configuration actuelle")
            st.json({
                "user_name": st.session_state.user_name,
                "theme": st.session_state.theme_preference,
                "notifications": st.session_state.notifications_enabled,
                "refresh_interval": st.session_state.data_refresh_interval,
                "timestamp": datetime.now().isoformat()
            })
        
        with col2:
            st.markdown("#### ğŸ”„ Actions systÃ¨me")
            
            if st.button("ğŸ—‘ï¸ RÃ©initialiser les paramÃ¨tres"):
                # RÃ©initialiser tous les paramÃ¨tres
                for key in list(st.session_state.keys()):
                    del st.session_state[key]
                st.rerun()
            
            if st.button("ğŸ“¥ Exporter la configuration"):
                st.download_button(
                    "ğŸ“ TÃ©lÃ©charger config.json",
                    data=str(st.session_state),
                    file_name=f"config_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json",
                    mime="application/json"
                )
    
    # Footer
    st.markdown("---")
    st.markdown("""
    ğŸ’¡ **Note :** Ces paramÃ¨tres sont stockÃ©s dans la session actuelle. 
    Dans la version complÃ¨te du template, vous trouverez une gestion persistante 
    des paramÃ¨tres utilisateur avec une base de donnÃ©es.
    """)

if __name__ == "__main__":
    main()